# Test Cases

## Этап 1 - Инфраструктура

### ✅ Тест-кейсы:
1. **Запуск docker-compose**
   - Команда: `docker-compose up -d`
   - Ожидаемый результат: Все сервисы запущены (postgres, redis, minio, api, worker)
   - Статус: ✅ Готово

2. **Установка зависимостей**
   - Команда: `cd api && bun install`
   - Ожидаемый результат: Все пакеты установлены без ошибок
   - Статус: ✅ Готово

## Этап 2 - БД

### ✅ Тест-кейсы:
1. **Генерация миграций**
   - Команда: `cd api && bun run db:generate`
   - Ожидаемый результат: Созданы файлы миграций в `src/db/migrations/`
   - Статус: ✅ Готово

2. **Выполнение миграций**
   - Команда: `cd api && bun run db:migrate`
   - Ожидаемый результат: Таблицы созданы в БД
   - Статус: ✅ Готово (требует запуска БД)

3. **Проверка схемы**
   - SQL: `\d assets` в psql
   - Ожидаемый результат: Таблица assets существует со всеми полями
   - Статус: ⚠️ Требует ручной проверки

## Этап 3 - Upload API

### ✅ Тест-кейсы:
1. **Инициализация загрузки**
   - Endpoint: `POST /uploads`
   - Body: `{ target: "new_asset", fileName: "test.pdf", mime: "application/pdf", totalSize: 1024 }`
   - Ожидаемый результат: `{ uploadId, partSize, bucket, key }`
   - Статус: ✅ Готово (требует JWT токена)

2. **Получение presigned URL для части**
   - Endpoint: `POST /uploads/:id/parts`
   - Body: `{ partNumber: 1 }`
   - Ожидаемый результат: `{ url, partNumber }`
   - Статус: ✅ Готово

3. **Завершение загрузки**
   - Endpoint: `POST /uploads/:id/complete`
   - Body: `{ parts: [{ partNumber: 1, etag: "..." }] }`
   - Ожидаемый результат: `{ assetId, versionId }`
   - Статус: ✅ Готово

4. **Отмена загрузки**
   - Endpoint: `POST /uploads/:id/abort`
   - Ожидаемый результат: `204 No Content`
   - Статус: ✅ Готово

## Этап 4 - Assets API

### ✅ Тест-кейсы:
1. **Список активов**
   - Endpoint: `GET /assets?query=test&type=image`
   - Ожидаемый результат: Список активов с пагинацией
   - Статус: ✅ Готово

2. **Получение актива**
   - Endpoint: `GET /assets/:id`
   - Ожидаемый результат: Детали актива
   - Статус: ✅ Готово

3. **Получение версий**
   - Endpoint: `GET /assets/:id/versions`
   - Ожидаемый результат: Список версий
   - Статус: ✅ Готово

4. **Presigned URL для скачивания**
   - Endpoint: `GET /download/:versionId`
   - Ожидаемый результат: `{ url, expiresIn }`
   - Статус: ✅ Готово

## Этап 5 - Worker

### ✅ Тест-кейсы:
1. **Обработка PDF**
   - Действие: Загрузить PDF файл
   - Ожидаемый результат: Созданы рендишены для всех страниц (512/1024/2048px)
   - Статус: ✅ Готово (требует тестирования)

2. **Обработка изображения**
   - Действие: Загрузить PNG/JPG файл
   - Ожидаемый результат: Созданы превью и тайлы
   - Статус: ✅ Готово (требует тестирования)

3. **Конвертация Office**
   - Действие: Загрузить DOCX файл
   - Ожидаемый результат: Конвертирован в PDF, созданы превью
   - Статус: ✅ Готово (требует тестирования)

## Этап 6 - Web UI

### ✅ Тест-кейсы:
1. **Загрузка файла через UI**
   - Действие: Перетащить файл в область загрузки
   - Ожидаемый результат: Файл загружается с прогресс-баром
   - Статус: ✅ Готово (требует тестирования)

2. **Просмотр списка активов**
   - Действие: Открыть главную страницу
   - Ожидаемый результат: Отображается список активов
   - Статус: ✅ Готово (требует тестирования)

3. **Поиск активов**
   - Действие: Ввести запрос в поле поиска
   - Ожидаемый результат: Отфильтрованный список
   - Статус: ✅ Готово (требует тестирования)

4. **Просмотр PDF**
   - Действие: Открыть PDF актив
   - Ожидаемый результат: PDF отображается с навигацией по страницам
   - Статус: ⚠️ Базовый функционал готов, нужна доработка

5. **Просмотр изображения**
   - Действие: Открыть изображение
   - Ожидаемый результат: Изображение отображается с зумом
   - Статус: ✅ Готово (требует тестирования)

## Этап 7 - Безопасность

### ✅ Тест-кейсы:
1. **Блокировка исполняемых файлов**
   - Действие: Попытаться загрузить .exe файл
   - Ожидаемый результат: Ошибка 400 "File type not allowed"
   - Статус: ✅ Готово (требует тестирования)

2. **Валидация MIME типов**
   - Действие: Загрузить файл с неразрешенным MIME типом
   - Ожидаемый результат: Ошибка валидации
   - Статус: ✅ Готово (требует тестирования)

## Интеграционные тесты

### ⚠️ Требуют реализации:
1. **Полный цикл загрузки большого файла**
   - Загрузить файл >10GB
   - Прервать сеть во время загрузки
   - Возобновить загрузку
   - Проверить успешное завершение

2. **Множественная загрузка**
   - Загрузить 50 файлов одновременно
   - Проверить все завершились успешно

3. **Версионность**
   - Загрузить новую версию существующего актива
   - Проверить сохранение истории версий

4. **Рендеринг**
   - Загрузить PDF с 100 страницами
   - Проверить генерацию превью за <60 сек

5. **Поиск**
   - Создать активы с разными тегами/типами
   - Выполнить поиск
   - Проверить время ответа <300 мс

